2021/08/01
-회원
-주소

이전에 진행한 당근마켓의 경우 사용자의 대력적인 위치정보만 필요.
하지만 쿠팡잇츠의 경우 배달의 특성 상 사용자의 상세주소가 요구됨
따라서 대략적인 주소(도로명 주소, 지번 주소)와 상세 주소(아파트, 층수, 호수)를 나눈다

대략주소는 크게 행정구역으로 구분하여 여러 테이블을 엮어 작성하고
상세주소는 위에서 작성한 대략주소 인덱스와 해당 사용자의 인덱스를 받아오고 상세주소는 사용자가
임의로 작성한 주소 정보를 text나 varchar(50)정도로 받아서 저장
addressCategory를 통해 실제 앱처럼 1. 집 2.회사 3.기타 로 카테고리를 구분 지어준다. 

행정구역 데이터를 효과적으로 관리하기 위해 
시/도 -> 시/군/구 -> 읍/면/동
ex) 경기도 -> 파주시 -> 와동동

이렇게 하면 대략주소를 상세주소와 엮어서 사용자의 주소 정보를 저장할 때 읍/면/동의 주소 인덱스만을 저장하여 낭비를 줄이고
전체적인 대략주소의 정보를 inner join 쿼리로 엮어서 가져올 수 있다.
또한 식당의 주소를 가져올 때도 활용할 수 있다.
+) 사용자 근처 식당을 필터링할 때 행정구역 코드를 활용할 수 있다.

실제 사용하는 행정구역 코드 사용,
국토부 자료를 mysql for excel을 통해 데이터 추출

******
거리계산 쿼리 (추후에 배달예상 시간에 사용할 계획) / 거리당 평균 배달 예상 시간을 대략 정해서 case when 으로 출력
SELECT (6371*acos(cos(radians(userLatitude))*cos(radians(restLatitude))*cos(radians(restHardness) -radians(userHardness))+sin(radians(userLatitude))*sin(radians(restLatitude)))) 
AS distance 
FROM Restaurant, UserAddress -- HAVING distance <= (이 값을 지정하면 특정거리 이하만 출력하게 할 수 있음) 
ORDER BY distance;
******


-쿠폰
Coupon, UserCoupon. 소멸시간 - 수정

-즐겨찾기

-결제수단

회원 당 여러개의 결제수단 저장 가능. 결제수단은 신용/체크카드 방식과 계좌이체 방식 2가지로 각각 담아야 하는 정보가 달라 테이블을 구분
신용/체크카드 -  카드번호, 유효기간
계좌이체 - 은행, 계좌번호

-검색기록

-카트 = 장바구니,  주문 전 확인사항 역할

카트당 메뉴가 여러개. 한 메뉴는 여러 카트에 담길 수 있음. -> 카트 테이블과 메뉴 테이블을 이어주는 중간 통로 테이블이 필요.

-MenuPerCart
카트담기 API를 통해 insert
카트담기 취소 API status : Y - > N

-메뉴
음식 카테고리 + 세부 메뉴 존재
특정 식당 조회 api에서 세부 메뉴에 따라서 메뉴를 구분하여 나열하되 전체를 보여줘야됨  case when
 
-메뉴 카테고리 : 총 25개

-식당

식당 대표 사진은 여러개 게시 가능 -> 새로운 테이블 필요
식당 주소는 오직 하나로 고정되므로 새로운 테이블이 필요 없음
매장정보 화면에서 식당위치를 지도위에 아이콘으로 냄. 지도 api가 필요

-식당대표 사진

-리뷰

api 만들때
포토리뷰 체크
정렬 - 최신순, 리뷰 도움순, 별점 높은 순, 별점 낮은 순


2021/08/02

-식당마다 카테고리 여러개 존재하므로 새로운 테이블 추가
-일부 컬럼 추가 및 삭제, 데이터 타입 수정

*****
홈화면에서 사용자의 주소 근처의 식당들을 조회해야됨
이때 행정구역 코드를 이용할 것. 행정코드가 근접할수록 서로 인접 지역이다.
이를 이용하여 조건문을 통해 사용자가 설정한 주소 근처의 식당만을 불러올 수 있다.
******

-주문 테이블 추가 = 결제를 진행한 카트
리뷰를 달 때 카트에 담기만 한 회원이 아니라 결제를 진행한 카트정보를 담고
그 카트에 담긴 메뉴에 대해서만 해당 회원이 리뷰를 달 수 있도록 해야 함

카트화면에서  결제하기 -> 결제 확인 창, 결제 확인하기 -> 주문 넣기 api로 주문 테이블에 데이터 삽입/ 실제 돈이 빠져나가는 로직은 x



2021/08/03

Order에 total price 추가
UserAddress, Cart에 회원의 주소 인덱스 추가 userAddressId
MenuPerCart에 각 메뉴의 수량 추가

쿠폰이 내가 생각했던 것과 달리 각 매장별로 적용하는 쿠폰만 있는 것 같다
그럼 식당 인덱스 컬럼을 추가해야됨

-> 전체 대상 쿠폰/ 특정 매장 쿠폰 나눠야 할 듯

리뷰 사진 여러개 가능 확인 - > 사진 테이블로 분리

홈화면에서 회원이 설정한 기본 주소 테이블 추가/ 여러개의 주소중 회원 당 하나의 기본 주소를 가짐


2021/08/04
식당 테이블
홈화면에 나타나는 대표 이미지 , 아이콘(null 가능) 컬럼 추가